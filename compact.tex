\chapter{Compact types}

In this chapter we introduce the notion of compact type, and we show that the compact types are closed under finite coproducts, $\Sigma$-types, finite products, pushouts, reflexive coequalizers, and retracts. In particular it follows that the spheres are compact.

In \cref{sec:localization_compact} we show that if $P$ and $Q$ are families of compact types, then the subuniverse of $F$-local types is reflective. Of course, one might impose stronger assumptions on the type theory so that the subuniverse of $F$-local types is reflective for any family $F$ of maps (see for instance \cite{RijkeShulmanSpitters}). The setting of this dissertation is that of univalent type theory in which the universes are closed under homotopy pushouts, so we have to find a different way to define localizations.

The idea is to approximate the $F$-localization of a type $X$ by iterated `quasi $F$-local extensions' of $X$, by which we mean a map $l:X\to Y$ equipped with a diagonal filler for the square
\begin{equation*}
\begin{tikzcd}
X^{Q_i} \arrow[r,"l\circ\blank"] \arrow[d,swap,"\blank\circ F_i"] & Y^{Q_i} \arrow[d,"\blank\circ F_i"] \\
X^{P_i} \arrow[r,swap,"l\circ \blank"] & Y^{P_i},
\end{tikzcd}
\end{equation*}
for each $i:I$. We show in \cref{prp:colim_local} that, provided that $F$ is a family of maps between compact types, the sequential colimit of type sequence
\begin{equation*}
\begin{tikzcd}
X_0 \arrow[r,"l_0"] & X_1 \arrow[r,"l_1"] & X_2 \arrow[r,"l_2"] & \cdots
\end{tikzcd}
\end{equation*}
is $F$-local if each $l_n$ has the structure of a quasi $F$-local extension. In \cref{lem:qflocal_initial} we show that there is an initial quasi $F$-local extension $l:X\to QL_F X$, for every type $X$, and in \cref{thm:localization} we show that the sequential colimit $X\to QL_F^\infty$ is an $F$-localization. Thus we establish that if $F$ is a family of maps between compact types, then the subuniverse of $F$-local types is a reflective subuniverse. Furthermore, if $A$ is a family of compact types, then the subuniverse of $A$-null types is a modality.

Dan Christensen pointed out that this construction of $F$-localization already appears in section 1.B of \cite{DrorFarjoun}, where arbitrary localizations are constructed by iterating the initial quasi $F$-local extension transfinitely many times. We stick to the case $\omega$ since larger ordinals are not yet as well understood in homotopy type theory. A minor note is that in Theorem B.5 Dror Farjoun only establishes that the transfinite colimit $QL_F^\kappa X$ localizes the homotopy groups.

\section{Compact types}

\begin{defn}
Consider a type sequence $\mathcal{A}\jdeq (A,f)$, and let $X$ be a type. We define the type sequence $\mathcal{A}^X$ to consist of
\begin{equation*}
\begin{tikzcd}
A_0^X \arrow[r,"f_0\circ \blank"] & A_1^X \arrow[r,"f_1\circ\blank"] & A_2^X \arrow[r,"f_2\circ\blank"] & \cdots. 
\end{tikzcd}
\end{equation*}
Futhermore, given a natural transformation $\tau:\mathsf{Seq}(\mathcal{A},\mathcal{B})$ of type sequences, we define the natural transformation $\tau^X$ to consist of
\begin{equation*}
\begin{tikzcd}[column sep=large]
A_0^X \arrow[r,"f_0\circ \blank"] \arrow[d,swap,"\tau_0\circ\blank"] & A_1^X \arrow[r,"f_1\circ\blank"] \arrow[d,swap,"\tau_1\circ\blank"] & A_2^X \arrow[r,"f_2\circ\blank"] \arrow[d,swap,"\tau_2\circ\blank"] & \cdots \\
B_0^X \arrow[r,swap,"g_0\circ \blank"] & B_1^X \arrow[r,swap,"g_1\circ\blank"] & B_2^X \arrow[r,swap,"g_2\circ\blank"] & \cdots
\end{tikzcd}
\end{equation*}
where the naturality squares commute by whiskering the natulity squares of $\tau$. 
\end{defn}

In particular, if $\tau:\mathsf{Seq}(\mathcal{A},\Delta Y)$ is a cocone with vertex $Y$, then $\tau^X :\mathsf{Seq}(\mathcal{A}^X,(\Delta Y)^X)$ is a cocone with vertex $Y^X$, since $(\Delta Y)^X \jdeq \Delta (Y^X)$.  

\begin{defn}
We call a type $X$ \define{(sequentially) compact} if for any type sequence
\begin{equation*}
\begin{tikzcd}
A_0 \arrow[r] & A_1 \arrow[r] & A_2 \arrow[r] & \cdots
\end{tikzcd}
\end{equation*}
the map
\begin{equation*}
\mathsf{seq\usc{}ind}(\mathsf{constr}(\mathcal{A})^X)
  : \tfcolim(X\to A_n)\to(X\to A_\infty)
\end{equation*}
is an equivalence.
\end{defn}

\begin{eg}
The empty type is compact, simply because $X^\emptyt$ is contractible for any type $X$, and a sequential colimit of contractible types is contractible.
\end{eg}

\begin{eg}
The unit type is compact because $\lam{x}\mathsf{const}_x:X\to X^\unit$ is an equivalence for any type $X$. Thus we obtain a natural equivalence
\begin{equation*}
\begin{tikzcd}
A_0 \arrow[d] \arrow[r] & A_1 \arrow[d] \arrow[r] & A_2 \arrow[d] \arrow[r] & \cdots \\
A_0^\unit \arrow[r] & A_1^\unit \arrow[r] & A_2^\unit \arrow[r] & \cdots.
\end{tikzcd}
\end{equation*}
Thus we obtain a commuting triangle
\begin{equation*}
\begin{tikzcd}[column sep=0]
 & A_\infty \arrow[dl] \arrow[dr] & \phantom{\mathsf{colim}(A_n^\unit)} \\
\mathsf{colim}(A_n^\unit) \arrow[rr] & & A_\infty^\unit.
\end{tikzcd}
\end{equation*}
where two out of three maps are equivalences. Therefore the unit type is compact by the 3-for-2 property.
\end{eg}

We will show in the remainder of this section that the compact types are closed under finite coproducts, $\Sigma$-types (and therefore also finite products), pushouts, reflexive coequalizers, and retracts. In the following example we note that compact types are not closed under pullbacks, and are not closed under exponentiation either.

\begin{rmk}
The compact types are not closed under identity types, because $\Z$ is not compact
and $\eqv{\Z}{\Omega(\Sn^1)}$. To see that $\Z$ is not compact, consider
the sequence $A_n\defeq\nat_{-n}$, where $\nat_{-n}$ is a version of the natural
numbers of starting at $-n$ and $A_n\to A_{n+1}$ is the inclusion map. The colimit
of $A_n$ is $\Z$ and the image of the map $\tfcolim(\Z\to A_n)\to (\Z\to\Z)$ is
the set of maps that are bounded from below. Thus, it is not surjective.

Also, the compact types are not closed under exponentiation. We have
the equivalence $\eqv{(\Sn^1\to\Sn^1)}{\Sn^1\times\Z}$, which is not
compact.
\end{rmk}

\begin{lem}
Finite coproducts of compact types are compact.
\end{lem}

\begin{proof}
We have already seen that the empty type is compact. 
Thus it remains to show that compact types are closed under disjoint
sums. 

Suppose that $X$ and $Y$ are compact. Then we have a commuting diagram of the form
\begin{equation*}
\begin{tikzcd}
\mathsf{colim}(\mathcal{A}^{X+Y}) \arrow[r] \arrow[d] & \mathsf{colim}(\mathcal{A}^X\times \mathcal{A}^Y) \arrow[r] & \mathsf{colim}(\mathcal{A}^X)\times\mathsf{colim}(\mathcal{A}^Y) \arrow[d] \\
A_{\infty}^{X+Y} \arrow[rr] & & A_\infty^X \times A_\infty^Y
\end{tikzcd}
\end{equation*}
where all but one of the maps are equivalences. Thus the remaining map is an equivalence too.
\end{proof}

\begin{defn}
Let $\mathcal{A}:X\to \mathsf{Seq}$ be an indexed type sequence. Then we define the type sequence $\prd{x:X}\mathcal{A}(x)$ to consist of
\begin{equation*}
\begin{tikzcd}[column sep=7em]
\prd{x:X}A_0(x) \arrow[r,"{\lam{h}{x}f_0(x,h(x))}"] & \prd{x:X}A_1(x) \arrow[r,"{\lam{h}{x}f_1(x,h(x))}"] & \cdots
\end{tikzcd}
\end{equation*}
\end{defn}

\begin{prp}
Let $\mathcal{A}:X\to\mathsf{Seq}$ be an indexed type sequence, indexed by a compact type $X$.
Then the canonical map
\begin{equation*}
\tfcolim\Big(\prd{x:X}A_n(x)\Big) \to \Big(\prd{x:X} A_\infty(x)\Big)
\end{equation*}
is an equivalence.
\end{prp}

\begin{proof}
Consider the commuting diagram
\begin{equation*}
\begin{tikzcd}
\mathsf{colim}\Big(\prd{x:X}\mathcal{A}(x)\Big) \arrow[d] \arrow[r] & \prd{x:X}A_\infty(x) \arrow[d] \arrow[r] & \unit \arrow[d,"\mathsf{const}_{\idfunc[X]}"] \\
\mathsf{colim}\Big(X\to\sm{x:X}A_n(x)\Big) \arrow[r] & \Big(X\to \sm{x:X}A_\infty(x)\Big) \arrow[r,swap,"\proj 1\circ\blank"] & (X\to X).
\end{tikzcd}
\end{equation*}
The square on the right and the outer rectangle are pullback squares. Hence the square on the left is a pullback square. Now observe that the type $\sm{x:X}A_\infty(X)$ is the sequential colimit of the type sequence $\sm{x:X}A_n(x)$, by \cref{thm:colim_sigma}. Therefore it follows by the assumption that $X$ is compact, that the bottom map in the left square is an equivalence. We conclude that the top map in the left square is an equivalence, proving the claim.
\end{proof}

\begin{cor}
Suppose $X$ is compact, and $Y(x)$ is compact for each $x:X$. Then the total space $\sm{x:X}Y(x)$ is also compact.
\end{cor}

\begin{proof}
Let $\mathcal{A}$ be a type sequence. Then we have the following commuting pentangle
\begin{equation*}
\begin{tikzcd}[column sep=-5em]
& \mathsf{colim}\Big(\mathcal{A}^{\sm{x:X}Y(x)}\Big) \arrow[rr] \arrow[dl] & & A_\infty^{\sm{x:X}Y(x)} \arrow[dr] \\
\mathsf{colim}\Big(\prd{x:X}\mathcal{A}^{Y(x)}\Big) \arrow[drr] & & & & \prd{x:X} A_\infty^{Y(x)} \\
& & \prd{x:X}\mathsf{colim}\Big(\mathcal{A}^{Y(x)}\Big) \arrow[urr] & \phantom{\mathsf{colim}\Big(\mathcal{A}^{\sm{x:X}Y(x)}\Big)} & \phantom{\mathsf{colim}\Big(\prd{x:X}\mathcal{A}^{Y(x)}\Big)}
\end{tikzcd}
\end{equation*}
in which all but the top map are known to be equivalences. Hence it follows that the top map is an equivalence, which shows that $\sm{x:X}Y(x)$ is compact.
\end{proof}

\begin{cor}
Compact types are closed under finite products.
\end{cor}

\begin{prp}\label{prp:pushout_compact}
Compact types are closed under pushouts.
\end{prp}

\begin{proof}
Consider a span $\mathcal{S}\jdeq (S,f,g)$ from $X$ to $Y$, where $X$, $Y$, and $S$ are assumed to be compact, and let $\mathcal{A}$ be a type sequence.
Then we have the commuting pentagon
\begin{equation*}
\begin{tikzcd}[column sep=-5em]
& \mathsf{colim}\Big(\mathcal{A}^{X\sqcup^{S} Y}\Big) \arrow[rr] \arrow[dl] &[-2em] &[-2em] A_\infty^{X\sqcup^S Y} \arrow[dr] \\
\mathsf{colim}\Big(\mathcal{A}^X\times_{\mathcal{A}^S}\mathcal{A}^Y\Big) \arrow[drr] & & & & A_\infty^X \times_{A_\infty^S} A_\infty^Y \\
& & \mathsf{colim}(\mathcal{A}^X)\times_{\mathsf{colim}(\mathcal{A}^S)}\mathsf{colim}(\mathcal{A}^Y) \arrow[urr] & \phantom{\mathsf{colim}\Big(\mathcal{A}^{X\sqcup^{S} Y}\Big)} & \phantom{\mathsf{colim}\Big(\mathcal{A}^X\times_{\mathcal{A}^S}\mathcal{A}^Y\Big)}
\end{tikzcd}
\end{equation*}
In this diagram, the downwards maps from the top left and from the top right are equivalences by the universal property of pushouts. The downwards map to the left side to the bottom is an equivalence since sequential colimits preserve pullbacks by \cref{thm:seq_colim_pb}. The map from the bottom to the right side is an equivalence by the assumption that $X$, $Y$, and $S$ are all compact types. Therefore we conclude that the top map is an equivalence, which proves the claim.
\end{proof}

\begin{cor}
Compact types are closed under joins, suspensions, and wedges. Furthermore, the cofiber of a map between compact types is again compact. In particular, all the spheres and the finite dimensional real and complex projective spaces are compact, and the smash product of compact pointed types is again compact.
\end{cor}

\begin{defn}
A reflexive graph $\mathcal{A}$ is said to be compact its types of vertices and (the total space of) edges are compact.
\end{defn}

\begin{cor}
The reflexive coequalizer of a compact reflexive graph is again compact.
\end{cor}

\begin{proof}
This follows immediately from \cref{prp:pushout_compact,thm:rcoeq_is_pushout}.
\end{proof}

\begin{prp}
Compact types are closed under retracts.
\end{prp}

\begin{proof}
Suppose that $Y$ is a retract of a compact type $X$, i.e.~we have $i:Y\to X$ and $r:X\to Y$ such that $r\circ i=\catid{Y}$. 
Note that for any type $Z$, the type $Z^Y$ is a retract of $Z^X$, since we have the section-retraction pair
\begin{equation*}
\begin{tikzcd}
Z^Y \arrow[r,"\blank\circ r"] & Z^X \arrow[r,"\blank\circ i"] & Z^Y.
\end{tikzcd}
\end{equation*}
It follows that for any type sequence $\mathcal{A}$ we have a section-retraction pair
\begin{equation*}
\begin{tikzcd}
\tfcolim(\mathcal{A}^Y) \arrow[r] \arrow[d] & \tfcolim(\mathcal{A}^X) \arrow[r] \arrow[d] & \tfcolim(\mathcal{A}^Y) \arrow[d]\\
A_\infty^Y \arrow[r] & A_\infty^X \arrow[r] & A_\infty^Y
\end{tikzcd}
\end{equation*}
of morphisms. Note that the downward morphism in the middle is an equivalence by the assumption that $X$ is compact. Recall from Theorem 4.7.4 of \cite{hottbook} that a retract of an equivalence is again an equivalence, so the claim follows.
\end{proof}

\section{Localizing at maps between compact types}\label{sec:localization_compact}
In this section, we assume to have $P,Q:I\to\UU$ and a family of maps $F:\prd{i:I} P(i)\to Q(i)$.

Recall type of diagonal fillers for a commuting square
\begin{equation*}
\begin{tikzcd}
A \arrow[d,swap,"f"] \arrow[r,"i"] & B \arrow[d,"g"] \\
X \arrow[r,swap,"j"] & Y
\end{tikzcd}
\end{equation*}
with $H:j\circ f\htpy g\circ i$ is defined to be the fiber of the gap map
\begin{equation*}
\mathsf{gap}:B^X \to B^A\times_{Y^A} Y^X
\end{equation*}
at the point $(i,j,\mathsf{eq\usc{}htpy}(H))$.

\begin{defn}
A \define{quasi $F$-local extension} of $X$ consists of a map $l:X\to Y$ equipped with a diagonal filler for the commuting square
\begin{equation*}
\begin{tikzcd}
X^{Q_i} \arrow[r,"l\circ\blank"] \arrow[d,swap,"\blank\circ F_i"] & Y^{Q_i} \arrow[d,"\blank\circ F_i"] \\
X^{P_i} \arrow[r,swap,"l\circ \blank"] & Y^{P_i},
\end{tikzcd}
\end{equation*}
for each $i:I$.
\end{defn}

\begin{lem}
Suppose $h:\mathsf{Seq}(\mathcal{A},\mathcal{B})$ is a natural transformation of type sequences equipped with the structure of a diagonal filler for each naturality square
\begin{equation*}
\begin{tikzcd}
A_n \arrow[r,"f_n"] \arrow[d,swap,"h_n"] & A_{n+1} \arrow[d,"h_{n+1}"] \\
B_n \arrow[r,swap,"g_n"] \arrow[ur,densely dotted] & B_{n+1}.
\end{tikzcd}
\end{equation*}
Then the map $h_\infty : A_\infty\to B_\infty$ is an equivalence. 
\end{lem}

\begin{proof}
Let us write $j_n:B_n\to A_{n+1}$ for the diagonal fillers, which come equipped with homotopies
\begin{align*}
J_n & : f_n\htpy j_n\circ h_n \\
K_n & : h_{n+1}\circ j_n \htpy g_n \\
L_n & : \ct{(h_{n+1}\cdot J_n)}{(K_n\cdot h_n)} \htpy H_n
\end{align*}
Note that $j$ is a natural transformation from $\mathcal{B}$ to the shifted sequence $\mathsf{shift}(\mathcal{A})$, with the homotopies $\ct{(f_{n+1}\cdot K_n)}{(J_{n+1}\cdot g_n)}: f_{n+1}\circ j_n \htpy j_{n+1}\circ g_n$ filling the naturality squares.

We claim that the composite $j\circ h$ is just the natural transformation $f:\mathcal{A}\to \mathsf{shift}(\mathcal{A})$. Indeed, we have the homotopy $J_n : j_n\circ h_n\htpy f_n$. Moreover, the type of $j_{n+1}\cdot L_n$
\begin{equation*}
\ct{(j_{n+1}\cdot h_{n+1}\cdot J_n)}{(j_{n+1}\cdot K_n\cdot h_n)} \htpy j_{n+1}\cdot H_n
\end{equation*}
is equivalent to the type of homotopies
\begin{align*}
& \ct{(J_{n+1}\cdot f_n)}{(j_{n+1}\cdot h_{n+1} \cdot J_n)}{(j_{n+1}\cdot K_n\cdot h_n)}{(j_{n+1}\cdot H_n)} \\
& \qquad\qquad \htpy \ct{\mathsf{htpy\usc{}refl}_{(f_{n+1}\circ f_n)}}{(J_{n+1}\cdot f_n)},
\end{align*}
filling the diagram
\begin{equation*}
\begin{tikzcd}
A_n \arrow[rr,"f_n"] \arrow[dr,"h_n"] \arrow[dd,swap,"f_n"] &[-1em] & A_{n+1} \arrow[dd,swap,"f_{n+1}" very near start] \arrow[dr,"h_{n+1}"] &[-1em] \\
& B_n \arrow[dl,swap,"j_n"] \arrow[rr,crossing over,"g_n" near start] & & B_{n+1} \arrow[dl,"j_{n+1}"] \\[1em]
A_{n+1} \arrow[urrr,crossing over,"h_{n+1}"] \arrow[rr,swap,"f_{n+1}"] & \phantom{A_{n+2}} & A_{n+2} & \phantom{A_{n+2}}
\end{tikzcd}
\end{equation*}
Therefore we obtain the coherence of the naturality squares needed to conclude that $f=j\circ h$ as natural transformations.

Likewise, the composite $\mathsf{shift}(h) \circ j$ is just the natural transformation $g:\mathcal{B}\to \mathsf{shift}(\mathcal{B})$. Therefore we obtain a commuting diagram
\begin{equation*}
\begin{tikzcd}[column sep=huge,row sep=large]
\mathsf{colim}(\mathcal{A}) \arrow[d,swap,"\mathsf{colim}(h)"] \arrow[r,"\mathsf{colim}(f)"] & \mathsf{colim}(\mathsf{shift}(\mathcal{A})) \arrow[d,"\mathsf{colim}(\mathsf{shift}(h))"] \\
\mathsf{colim}(\mathcal{B}) \arrow[r,swap,"\mathsf{colim}(g)"] \arrow[ur,"\mathsf{colim}(j)"] & \mathsf{colim}(\mathsf{shift}(\mathcal{B}))
\end{tikzcd}
\end{equation*}
Since both $\tfcolim(f)$ and $\tfcolim(g)$ are equivalences by \cref{lem:colim_shift}, it follows by the 6-for-2 property of equivalences (see Exercise 4.5 of \cite{hottbook}), that the remaining maps are equivalences. In particular $\tfcolim(h)$ is an equivalence. 
\end{proof}

\begin{prp}\label{prp:colim_local}
Suppose $F$ is a family of maps between compact types, and let
\begin{equation*}
\begin{tikzcd}
X_0 \arrow[r,"l"] & X_1 \arrow[r,"l"] & X_2 \arrow[r,"l"] & \cdots
\end{tikzcd}
\end{equation*}
be a sequence of types in which each $X_{n+1}$ is a quasi $F$-local extension of $X_n$. Then the sequential colimit $X_\infty$ is $F$-local.
\end{prp}

\begin{proof}
We have a natural transformation $F_i^\ast : \mathsf{Seq}(\mathcal{X}^{Q_i},\mathcal{X}^{P_i})$ for which each naturality square comes equipped with a diagonal filler
\begin{equation*}
\begin{tikzcd}
X_0^{Q_i} \arrow[d,swap,"F_i^\ast"] \arrow[r] & X_1^{Q_i} \arrow[d,swap,"F_i^\ast"] \arrow[r] & X_2^{Q_i} \arrow[d,swap,"F_i^\ast"] \arrow[r] & \cdots \\
X_0^{P_i} \arrow[r] \arrow[ur,densely dotted] & X_1^{P_i} \arrow[r] \arrow[ur,densely dotted] & X_2^{P_i} \arrow[r] \arrow[ur,densely dotted] & \cdots
\end{tikzcd}
\end{equation*}
by the assumption that each $l_n:X_n\to X_{n+1}$ is a quasi $F$-local extension. Therefore $\mathsf{colim}(F_i^\ast)$ is an equivalence. Note that we have the commuting square
\begin{equation*}
\begin{tikzcd}
\mathsf{colim}(X_n^{Q_i}) \arrow[r] \arrow[d,swap,"\mathsf{colim}(F_i^\ast)"] & X_{\infty}^{Q_i} \arrow[d,"F_i^\ast"] \\
\mathsf{colim}(X_n^{P_i}) \arrow[r] & X_\infty^{P_i}
\end{tikzcd}
\end{equation*}
in which the top and bottom maps are equivalences by the assumption that $P_i$ and $Q_i$ are compact. Therefore we conclude that $F_i^\ast : X_\infty^{Q_i}\to X_\infty^{P_i}$ is an equivalence. It follows that $X_\infty$ is $F$-local.
\end{proof}

Our goal is now to construct the initial quasi $F$-local extension of a type $X$, and use it to show that the subuniverse of $F$-local types is reflective. For any $i:I$, we have the maps
\begin{align*}
F_i : P_i \to Q_i \\
F_i^\ast : X^{Q_i} \to X^{P_i}.
\end{align*}
In the following characterization of quasi $F$-local extensions we use the pushout-product $F_i^\ast\square F_i$, which is defined as follows
\begin{equation*}
\begin{tikzcd}
X^{Q_i}\times P_i \arrow[r] \arrow[d] & X^{Q_i}\times Q_i \arrow[ddr,bend left=15] \arrow[d] \\
X^{P_i}\times P_i \arrow[drr,bend right=15] \arrow[r] & \big(X^{P_i} \times P_i\big)\sqcup^{\big(X^{Q_i}\times P_i\big)}\big(X^{Q_i}\times Q_i\big) \arrow[dr,densely dotted,swap,"F_i^\ast\square F_i"] \\
& & X^{P_i}\times Q_i
\end{tikzcd}
\end{equation*}
by the universal property of pushouts. Also note that the outer square in the diagram
\begin{equation*}
\begin{tikzcd}
X^{Q_i}\times P_i \arrow[r] \arrow[d] & X^{Q_i}\times Q_i \arrow[ddr,bend left=15,"\mathsf{ev}"] \arrow[d] &[2em] \\
X^{P_i}\times P_i \arrow[drr,bend right=15,swap,"\mathsf{ev}"] \arrow[r] & \big(X^{P_i} \times P_i\big)\sqcup^{\big(X^{Q_i}\times P_i\big)}\big(X^{Q_i}\times Q_i\big) \arrow[dr,densely dotted,swap,"\varepsilon_i"] \\
& & X
\end{tikzcd}
\end{equation*}
commutes, so we get a map $\varepsilon_i$ as indicated.

\begin{lem}\label{lem:qflocal_characterize}
For any type $l:X\to Y$, the type of $I$-indexed families of diagonal fillers for the squares
\begin{equation*}
\begin{tikzcd}
X^{Q_i} \arrow[r,"l\circ\blank"] \arrow[d,swap,"\blank\circ F_i"] & Y^{Q_i} \arrow[d,"\blank\circ F_i"] \\
X^{P_i} \arrow[r,swap,"l\circ \blank"] & Y^{P_i}
\end{tikzcd}
\end{equation*}
is equivalent to the type of morphisms $j:X^{P_i}\times Q_i\to Y$ equipped with a homotopy witnessing that the square
\begin{equation*}
\begin{tikzcd}[column sep=large]
\sm{i:I}\Big(\big(X^{P_i} \times P_i\big)\sqcup^{\big(X^{Q_i}\times P_i\big)}\big(X^{Q_i}\times Q_i\big)\Big) \arrow[r,"F_i^\ast\square F_i"] \arrow[d,swap,"\lam{(i,t)}\varepsilon_i(t)"] & \sm{i:I} X^{P_i}\times Q_i \arrow[d] \\
X \arrow[r] & Y
\end{tikzcd}
\end{equation*}
commutes.
\end{lem}

\begin{defn}
For any type $X$, we define the initial quasi $F$-local extension $l:X\to QL_FX$ of $X$ to be the pushout
\begin{equation*}
\begin{tikzcd}[column sep=large]
\sm{i:I}\Big(\big(X^{P_i} \times P_i\big)\sqcup^{\big(X^{Q_i}\times P_i\big)}\big(X^{Q_i}\times Q_i\big)\Big) \arrow[r,"F_i^\ast\square F_i"] \arrow[d,swap,"\lam{(i,t)}\varepsilon_i(t)"] & \sm{i:I} X^{P_i}\times Q_i \arrow[d] \\
X \arrow[r,swap,"l"] & QL_FX
\end{tikzcd}
\end{equation*}
\end{defn}

\begin{rmk}
The initial quasi $F$-local extension of a type $X$ is initial by the universal property of the pushout and the characterization of \cref{lem:qflocal_characterize}.
\end{rmk}

\begin{cor}
If $X$ is $F$-local, then $l:X\to QL_F X$ is an equivalence.
\end{cor}

\begin{proof}
If $X$ is $F$-local, then each $F_i^\ast$ is an equivalence. It follows that the pushout-product $F_i^\ast\square F_i$ is an equivalence. Since pushouts of equivalences are equivalences, the claim follows.
\end{proof}

\begin{thm}
For any type $X$ and any family $F:\prd{a:A}P(a)\to Q(a)$ of maps between
compact types, the subuniverse of $F$-local types is reflective.
\end{thm}

\begin{proof}
We define the localization $\eta:X\to LX$ as the sequential colimit
\begin{equation*}
\begin{tikzcd}
X \arrow[r] & QL_F X \arrow[r] & QL_F^2 X \arrow[r] & \cdots
\end{tikzcd}
\end{equation*}
Since each $l:QL_F^n X\to QL_F^{n+1}X$ has the structure of a quasi $F$-local extension, it follows by \cref{prp:colim_local} that $LX$ is $F$-local. It remains to show that for any $F$-local type $Y$, the precomposition map
\begin{equation*}
\eta^\ast : (LX\to Y)\to (X\to Y)
\end{equation*}
is an equivalence.

We have to show that for any function $h:X\to Y$ into an
$F$-local type $Y$, there is a unique function $\tilde{h}: L^\infty(X)\to
Y$ such that the triangle
\begin{equation*}
\begin{tikzcd}
X \arrow[dr,"h"] \arrow[d,swap,"\iota_0"] \\ 
L^\infty(X) \arrow[r,swap,"\tilde{h}"] & Y
\end{tikzcd}
\end{equation*}
commutes. To define $\tilde{h}$ for any $h:X\to Y$ into an $F$-local type, 
it suffices to define $h^1:L(X)\to Y$. To define $h^1$, we need to construct
\begin{align*}
d & : \prd{f:P(a)\to X} \hfib{\psi_Y(a)}{h\circ f}\\
D & : \prd{f:P(a)\to X}{w:\hfib{\psi_{X}(a)}{f}}\id{i(w)}{d}
\end{align*}
We get these terms immediately from the assumption that $Y$ is $F$-local.
Note also that the type of the pair $\pairr{d,D}$ is contractible, so uniqueness
follows immediately.

The above universal property and the fact that $L^\infty(X)$ is $F$-local
together give that $L^\infty(X)$ is the localization of $X$ at $F$.
\end{proof}

\begin{cor}
For any family $N:I\to \UU$ of compact types, the subuniverse of $N$-null types is a modality.
\end{cor}

\section{Inductive types specified by families of compact types}
